<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#ffffff">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>MindfulDay</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="style.css?v=2.19">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="lotus-icon.png">
    <link rel="apple-touch-icon" href="lotus-icon.png">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="firebase-config.js"></script>
    <style>
        /* Removed fixed size override to allow scaling */
    </style>
</head>

<body>
    <div class="app-container">
        <!-- Area 1: Title Area (4%) -->
        <header class="title-area">
            <div class="title-card">Mindful Day</div>
        </header>

        <!-- Area 2: Main Area (65%) -->
        <main class="main-area" id="mainPanel">
            <!-- Activity Grid (Run Mode) -->
            <div class="activity-grid" id="activityGrid"></div>

            <!-- Measure Mode Panels (Hidden by default) -->
            <div id="measurePanel" class="measure-container" style="display: none;">
                <div class="tab-navigation">
                    <button class="tab-btn active" data-target="measureToday">Today</button>
                    <button class="tab-btn" data-target="measureYesterday">Yesterday</button>
                </div>
                <div id="measureToday" class="tab-content monitor-view"></div>
                <div id="measureYesterday" class="tab-content monitor-view" style="display: none;">
                    <div style="padding: 20px; text-align: center; color: #888;">No data for yesterday</div>
                </div>
            </div>

            <!-- Settings Panel (Hidden by default) -->
            <div id="settingsPanel" class="settings-container" style="display: none;">
                <div id="settingsContent"></div>
            </div>

            <!-- Focus View (Overlay/Embedded) -->
            <div class="focus-view" id="focusView" style="display: none;">
                <button class="close-btn" id="closeFocusBtn">&times;</button>
                <div class="focus-content">
                    <div class="focus-icon-wrapper">
                        <img id="focusIcon" src="" alt="Activity Icon">
                    </div>
                    <!-- Large Timer in Main View -->
                    <div class="focus-timer-block green-block">
                        <span class="focus-label" id="focusLabel">ACTIVITY</span>
                        <span class="focus-timer" id="focusTimer">00:00:00</span>
                    </div>
                </div>
            </div>
        </main>

        <!-- Area 3: Timer Area (10%) -->
        <section class="timer-area">
            <div class="timer-pill green-pill">
                <span id="currentActivityLabel" class="timer-label-overlay">Ready</span>
                <span id="currentActivityTimer">00:00</span>
            </div>
            <div class="timer-pill orange-pill">
                <span class="timer-label-overlay">All Day</span>
                <span id="dayTimer">00:00:00</span>
            </div>
        </section>

        <!-- Area 4: Progress Area (12%) -->
        <section class="progress-area">
            <!-- Top: Today Progress -->
            <div class="progress-bar-container">
                <div class="progress-bar todays-progress" id="timelineProgress">
                    <span class="progress-text">Today</span>
                </div>
            </div>
            <!-- Bottom: Life Progress -->
            <div class="progress-bar-container">
                <div class="progress-bar life-progress" id="lifeProgressBar">
                    <span class="progress-text" id="lifeProgressText">Loading...</span>
                </div>
            </div>
        </section>

        <!-- Area 5: Navigation Area (9%) -->
        <nav class="navigation-area">
            <button class="nav-btn active" data-mode="run">
                <img src="icons/run_mode.svg" alt="Run">
            </button>
            <button class="nav-btn" data-mode="measure">
                <img src="icons/measure_mode.svg" alt="Measure">
            </button>
            <button class="nav-btn" data-mode="settings">
                <img src="icons/settings_mode.svg" alt="Settings">
            </button>
        </nav>

        <!-- Quote Overlay -->
        <div class="quote-overlay" id="quoteOverlay" style="display: none;">
            <div class="quote-card">
                <button class="quote-close-btn" onclick="hideQuoteOverlay()">&times;</button>
                <div class="quote-content">
                    <img id="quoteAuthorImg" src="" class="quote-author-img" alt="Author">
                    <div id="quoteText" class="quote-text">Loading quote...</div>
                    <img id="quoteSignImg" src="" class="quote-sign-img" alt="Author Signature">
                </div>
            </div>
        </div>
    </div>

    <!-- Slide-to-Confirm Modal -->
    <div class="confirm-modal" id="confirmModal" style="display: none;">
        <div class="confirm-card">
            <button class="close-btn" id="closeConfirmBtn">&times;</button>

            <!-- Icon Transition (Current -> New) -->
            <div class="confirm-icon-wrapper">
                <img id="confirmCurrentIcon" src="icons/run_mode.svg" alt="Current" style="opacity: 0.5;">
                <div class="confirm-arrow">
                    <i class="ph ph-arrow-right" style="font-size: 32px; color: #ccc;"></i>
                </div>
                <img id="confirmNewIcon" src="" alt="New Activity">
            </div>

            <div class="confirm-title" id="confirmTitle">Start a new timer?</div>

            <!-- Slider Component -->
            <div class="slider-container" id="sliderContainer">
                <div class="slider-track">
                    <div class="slider-text">Slide to confirm</div>
                </div>
                <div class="slider-handle" id="sliderHandle">
                    <img src="icons/run_mode.svg" alt=">">
                </div>
            </div>

            <!-- Current Timer (Green) -->
            <div class="focus-timer-block green-block" id="confirmCurrentBlock">
                <span class="focus-label" id="confirmCurrentLabel">CURRENT</span>
                <span class="focus-timer" id="confirmCurrentTimer">00:00:00</span>
            </div>

            <!-- Day Timer (Orange) -->
            <div class="focus-timer-block orange-block" id="confirmDayBlock">
                <span class="focus-label">ALL DAY</span>
                <span class="focus-timer" id="confirmDayTimer">00:00:00</span>
            </div>
        </div>
    </div>

    <script>
        // Global Log for PWA Debugging
        window.pwaDebugLog = window.pwaDebugLog || [];
        function logPWA(msg) {
            console.log('[PWA Debug]', msg);
            window.pwaDebugLog.push(new Date().toLocaleTimeString() + ': ' + msg);
            // If app is running and settings open, trigger refresh (optional, handled by app.js polling or user refresh)
        }

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => {
                        logPWA('SW Registered. Scope: ' + reg.scope);
                        if (reg.installing) logPWA('SW Installing');
                        if (reg.waiting) logPWA('SW Waiting/Installed');
                        if (reg.active) logPWA('SW Active');
                    })
                    .catch(err => logPWA('SW Registration Failed: ' + err));
            });
        } else {
            logPWA('Service Worker not supported');
            logPWA('Secure Context: ' + window.isSecureContext);
            logPWA('Protocol: ' + window.location.protocol);
            logPWA('Hostname: ' + window.location.hostname);
        }
    </script>
    <script src="app.js?v=force_18"></script>
</body>

</html>